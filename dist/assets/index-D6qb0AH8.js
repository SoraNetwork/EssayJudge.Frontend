import{Q as E,r as s,d as M,Y as D,W as T,H as p,x as t,X as a,_ as n,Z as C,a6 as $,ab as W,a0 as j}from"./index--uryIc9t.js";import{p as H,d as Q,q as R,r as X,t as Y}from"./VList-Bw5JRA7I.js";import{V as d,p as I}from"./VAvatar-Cjt3-t6c.js";import{b as k,V as w,a as S,c as B}from"./VCard-Baw6fKXM.js";import{V as Z}from"./VDataTable-Dprc95IX.js";import{V as G}from"./VChip-CTpQQSB7.js";import{V as J}from"./VForm-E8O1qvQD.js";import{a as L}from"./VTextField-B7WNoRZT.js";import{V as N}from"./VSpacer-mriSOV0H.js";import{V as F}from"./VDialog-CJbZZ0LG.js";import{V as O}from"./VAlert-CQi6o4jK.js";import"./VSelect-C7-6oE3D.js";import"./forwardRefs-TdIUcFqw.js";import"./VOverlay-CaEAIGL2.js";import"./dialog-transition-C45ZtiWV.js";/* empty css              */const P={class:"d-flex justify-space-between align-center mb-4"},h={class:"text-h5"},ee={key:0,class:"mt-2"},ye=E({__name:"index",setup(te){const K=[{title:"班级名称",key:"name"},{title:"学生数量",key:"studentCount"},{title:"操作",key:"actions",sortable:!1}],V=s([]),c=s(!1),m=s(!1),f=s(!1),y=s(!1),_=s(!1),v=s(!1),b=s(null),i=s({id:"",name:""}),r=s(null);async function x(){c.value=!0;try{const o=await H(),e=[];for(const l of o||[])try{const u=await Q({classId:l.id});e.push({id:l.id,name:l.name,studentCount:u.length||0})}catch(u){console.error(`获取班级 ${l.name} 的学生数量失败:`,u),e.push({id:l.id,name:l.name,studentCount:0})}V.value=e}catch(o){console.error("获取班级列表失败:",o),V.value=[]}finally{c.value=!1}}function U(o){v.value=!0,i.value={...o},m.value=!0}async function g(){const{valid:o}=await b.value.validate();if(o){y.value=!0;try{const e={name:i.value.name};if(v.value){if(!i.value.id){console.error("Cannot update class without an ID");return}await R(i.value.id,e)}else await X(e);m.value=!1,await x(),A()}catch(e){console.error("保存班级失败:",e)}finally{y.value=!1}}}function q(o){r.value=o,f.value=!0}async function z(){if(r.value){_.value=!0;try{await Y(r.value.id),f.value=!1,await x()}catch(o){console.error("删除班级失败:",o)}finally{_.value=!1,r.value=null}}}function A(){v.value=!1,i.value={id:"",name:""}}return M(()=>{x()}),(o,e)=>(T(),D("div",null,[p("div",P,[e[7]||(e[7]=p("h1",{class:"text-h4"},"班级管理",-1)),t(d,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>m.value=!0)},{default:a(()=>e[6]||(e[6]=[n("添加班级")])),_:1,__:[6]})]),t(w,null,{default:a(()=>[t(k,null,{default:a(()=>[t(Z,{headers:K,items:V.value,loading:c.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.studentCount":a(({item:l})=>[t(G,{color:"primary",variant:"outlined"},{default:a(()=>[n(C(l.studentCount||0),1)]),_:2},1024)]),"item.actions":a(({item:l})=>[t(d,{icon:"",variant:"text",size:"small",onClick:u=>U(l)},{default:a(()=>[t(I,null,{default:a(()=>e[8]||(e[8]=[n("mdi-pencil")])),_:1,__:[8]})]),_:2},1032,["onClick"]),t(d,{icon:"",variant:"text",size:"small",color:"error",onClick:u=>q(l)},{default:a(()=>[t(I,null,{default:a(()=>e[9]||(e[9]=[n("mdi-delete")])),_:1,__:[9]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(F,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value=l),"max-width":"600px"},{default:a(()=>[t(w,null,{default:a(()=>[t(S,null,{default:a(()=>[p("span",h,C(v.value?"编辑班级":"添加班级"),1)]),_:1}),t(k,null,{default:a(()=>[t(J,{ref_key:"form",ref:b,onSubmit:$(g,["prevent"])},{default:a(()=>[t(L,{modelValue:i.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.name=l),label:"班级名称",rules:[l=>!!l||"班级名称不能为空"],required:"",onKeyup:W($(g,["prevent"]),["enter"])},null,8,["modelValue","rules","onKeyup"])]),_:1},512)]),_:1}),t(B,null,{default:a(()=>[t(N),t(d,{color:"error",variant:"text",onClick:e[2]||(e[2]=l=>m.value=!1)},{default:a(()=>e[10]||(e[10]=[n("取消")])),_:1,__:[10]}),t(d,{color:"primary",onClick:g,loading:y.value},{default:a(()=>e[11]||(e[11]=[n("保存")])),_:1,__:[11]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(F,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=l=>f.value=l),"max-width":"400px"},{default:a(()=>[t(w,null,{default:a(()=>[t(S,{class:"text-h5"},{default:a(()=>e[12]||(e[12]=[n("确认删除")])),_:1,__:[12]}),t(k,null,{default:a(()=>{var l;return[e[13]||(e[13]=n(" 确定要删除班级 ")),p("strong",null,C((l=r.value)==null?void 0:l.name),1),e[14]||(e[14]=n(" 吗？此操作不可撤销。 ")),r.value&&r.value.studentCount>0?(T(),D("div",ee,[t(O,{type:"warning",variant:"tonal",density:"compact"},{default:a(()=>{var u;return[n(" 注意：该班级下有 "+C((u=r.value)==null?void 0:u.studentCount)+" 名学生，删除班级将导致这些学生失去班级关联。 ",1)]}),_:1})])):j("",!0)]}),_:1,__:[13,14]}),t(B,null,{default:a(()=>[t(N),t(d,{color:"primary",variant:"text",onClick:e[4]||(e[4]=l=>f.value=!1)},{default:a(()=>e[15]||(e[15]=[n("取消")])),_:1,__:[15]}),t(d,{color:"error",onClick:z,loading:_.value},{default:a(()=>e[16]||(e[16]=[n("删除")])),_:1,__:[16]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{ye as default};
