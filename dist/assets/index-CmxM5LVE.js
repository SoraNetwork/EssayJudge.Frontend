import{Q as M,r as n,d as j,Y as L,W as Q,H as c,x as t,X as a,_ as i,$ as w,a5 as W}from"./index-DrtXJ76k.js";import{g as X,e as Y,f as G,h as J}from"./VOverlay-D7KLqul2.js";import{V as s,o as x}from"./VAvatar-D6tovhXD.js";import{b as C,V as y,a as _,d as A,e as T}from"./VTextField-Cbwj9afB.js";import{V as K}from"./VDataTable-yaTI-PlP.js";import{V as O}from"./VForm-CzPAKgQp.js";import{a as P}from"./VSelect-DF8LjojY.js";import{V as b}from"./VTextarea-Cb3Hx-Wo.js";import{V as U}from"./VSpacer-B133BwxA.js";import{V as $}from"./VDialog-BZLPLVZ4.js";import"./scopeId-C9l49y41.js";/* empty css              */const R={class:"d-flex justify-space-between align-center mb-4"},Z={class:"text-h5"},ge=M({__name:"index",setup(h){function q(r){const e={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},l=new Date(r);return l.setHours(l.getHours()+8),l.toLocaleString(void 0,e)}const v=n(!1),u=n(!1),B=[{title:"描述",key:"Description"},{title:"年级",key:"grade"},{title:"创建时间",key:"createdAt"},{title:"操作",key:"actions",sortable:!1}],S=n([]),d=n(!1),f=n(!1),p=n(!1),m=n(!1),D=n(null),z=n([{grade:"一年级",string:"一年级"},{grade:"二年级",string:"二年级"},{grade:"三年级",string:"三年级"},{grade:"四年级",string:"四年级"},{grade:"五年级",string:"五年级"},{grade:"六年级",string:"六年级"},{grade:"初一",string:"初一"},{grade:"初二",string:"初二"},{grade:"初三",string:"初三"},{grade:"高一",string:"高一"},{grade:"高二",string:"高二"},{grade:"高三",string:"高三"}]),o=n({id:"",grade:null,totalScore:null,baseScore:null,Description:"",scoringCriteria:"",titleContext:""}),g=n(null),F=r=>{g.value=r,d.value=!0},H=r=>{m.value=!0,o.value={id:r.id,grade:r.grade||null,totalScore:r.totalScore||null,baseScore:r.baseScore||null,scoringCriteria:r.scoringCriteria||"",Description:r.Description||null,titleContext:r.titleContext||null},u.value=!0},V=async()=>{v.value=!0;try{const r=await X();S.value=r||[]}catch(r){console.error("获取测验列表失败:",r)}finally{v.value=!1}},k=async()=>{const{valid:r}=await D.value.validate();if(r){f.value=!0;try{const e={scoringCriteria:o.value.scoringCriteria,grade:o.value.grade||void 0,totalScore:o.value.totalScore||void 0,baseScore:o.value.baseScore||void 0,titleContext:o.value.titleContext||void 0,Description:o.value.Description||void 0};m.value?await Y(o.value.id,e):await G(e),u.value=!1,await V(),E()}catch(e){console.error("保存测验失败:",e)}finally{f.value=!1}}},N=async()=>{if(g.value){p.value=!0;try{await J(g.value.id),d.value=!1,await V()}catch(r){console.error("删除测验失败:",r)}finally{p.value=!1,g.value=null}}},E=()=>{m.value=!1,o.value={id:"",grade:null,totalScore:null,baseScore:null,scoringCriteria:"",Description:"",titleContext:""}};return j(()=>{V()}),(r,e)=>(Q(),L("div",null,[c("div",R,[e[12]||(e[12]=c("h1",{class:"text-h4"},"测验管理",-1)),t(s,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>u.value=!0)},{default:a(()=>e[11]||(e[11]=[i("新建测验")])),_:1,__:[11]})]),t(y,null,{default:a(()=>[t(C,null,{default:a(()=>[t(K,{headers:B,items:S.value,loading:v.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.createdAt":a(({item:l})=>[i(w(q(l.createdAt)),1)]),"item.actions":a(({item:l})=>[t(s,{icon:"",variant:"text",size:"small",to:`/assignments/${l.id}`},{default:a(()=>[t(x,null,{default:a(()=>e[13]||(e[13]=[i("mdi-eye")])),_:1,__:[13]})]),_:2},1032,["to"]),t(s,{icon:"",variant:"text",size:"small",onClick:I=>H(l)},{default:a(()=>[t(x,null,{default:a(()=>e[14]||(e[14]=[i("mdi-pencil")])),_:1,__:[14]})]),_:2},1032,["onClick"]),t(s,{icon:"",variant:"text",size:"small",color:"error",onClick:I=>F(l)},{default:a(()=>[t(x,null,{default:a(()=>e[15]||(e[15]=[i("mdi-delete")])),_:1,__:[15]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t($,{modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value=l),"max-width":"600px"},{default:a(()=>[t(y,null,{default:a(()=>[t(_,null,{default:a(()=>[c("span",Z,w(m.value?"编辑测验":"新建测验"),1)]),_:1}),t(C,null,{default:a(()=>[t(O,{ref_key:"form",ref:D,onSubmit:W(k,["prevent"])},{default:a(()=>[t(P,{modelValue:o.value.grade,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.grade=l),items:z.value,"item-title":"grade","item-value":"string",label:"选择年级",required:""},null,8,["modelValue","items"]),t(A,{modelValue:o.value.totalScore,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.totalScore=l),label:"总分",type:"number",rules:[l=>l!=null&&l>0||"总分必须大于0"],required:""},null,8,["modelValue","rules"]),t(A,{modelValue:o.value.baseScore,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.baseScore=l),label:"基础分",type:"number",rules:[l=>l!=null&&l>0||"基础分必须大于0"],required:""},null,8,["modelValue","rules"]),t(b,{modelValue:o.value.titleContext,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.titleContext=l),label:"标题",rows:"5"},null,8,["modelValue"]),t(b,{modelValue:o.value.Description,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.Description=l),label:"描述",rows:"5"},null,8,["modelValue"]),t(b,{modelValue:o.value.scoringCriteria,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.scoringCriteria=l),label:"评分标准",rules:[l=>!!l||"评分标准不能为空"],required:"",rows:"5"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),t(T,null,{default:a(()=>[t(U),t(s,{color:"error",variant:"text",onClick:e[7]||(e[7]=l=>u.value=!1)},{default:a(()=>e[16]||(e[16]=[i("取消")])),_:1,__:[16]}),t(s,{color:"primary",onClick:k,loading:f.value},{default:a(()=>e[17]||(e[17]=[i("保存")])),_:1,__:[17]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:d.value,"onUpdate:modelValue":e[10]||(e[10]=l=>d.value=l),"max-width":"400px"},{default:a(()=>[t(y,null,{default:a(()=>[t(_,{class:"text-h5"},{default:a(()=>e[18]||(e[18]=[i("确认删除")])),_:1,__:[18]}),t(C,null,{default:a(()=>e[19]||(e[19]=[i("确定要删除这个测验吗？此操作不可撤销。")])),_:1,__:[19]}),t(T,null,{default:a(()=>[t(U),t(s,{color:"primary",variant:"text",onClick:e[9]||(e[9]=l=>d.value=!1)},{default:a(()=>e[20]||(e[20]=[i("取消")])),_:1,__:[20]}),t(s,{color:"error",onClick:N,loading:p.value},{default:a(()=>e[21]||(e[21]=[i("删除")])),_:1,__:[21]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{ge as default};
