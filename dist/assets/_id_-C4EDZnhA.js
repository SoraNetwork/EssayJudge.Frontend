import{Q as H,a6 as Q,R as W,c as G,r as n,d as X,Y as d,W as m,x as t,X as l,_ as s,H as f,$ as u,E as Y,a5 as K}from"./index-DrtXJ76k.js";import{V as O,i as Z,s as h,e as ee}from"./VOverlay-D7KLqul2.js";import{V as v,p as te,o as g}from"./VAvatar-D6tovhXD.js";import{a as T,b as y,V as b,d as S,e as le}from"./VTextField-Cbwj9afB.js";import{a as ae,V as M}from"./VRow-9Ta8N-Ip.js";import{V as re}from"./VSheet-Bovs7rhU.js";import{d as se,V as x,e as C,f as w,c as oe}from"./scopeId-C9l49y41.js";import{V as ie}from"./VDataTable-yaTI-PlP.js";import{V as ue}from"./VForm-CzPAKgQp.js";import{a as ne}from"./VSelect-DF8LjojY.js";import{V as de}from"./VTextarea-Cb3Hx-Wo.js";import{V as me}from"./VSpacer-B133BwxA.js";import{V as fe}from"./VDialog-BZLPLVZ4.js";/* empty css              */const ve={key:0,class:"d-flex justify-center align-center",style:{height:"400px"}},ge={key:1,class:"text-center py-8"},pe={class:"text-h5 text-error"},ce={key:2},Ve={class:"text-body-1",style:{"white-space":"pre-wrap","line-height":"1.8"}},_e={class:"text-h4 font-weight-bold"},ye={key:1},Ge=H({__name:"[id]",setup(be){const q=Q();W();const I=G(()=>q.params.id),o=n({id:"",title:"",grade:null,totalScore:null,baseScore:null,scoringCriteria:"",createdAt:"",updatedAt:""}),V=n([]),k=n(!0),D=n(!0),p=n(""),c=n(!1),A=n(!1),_=n(""),L=n(null),i=n({id:"",grade:null,title:"",totalScore:null,baseScore:null,scoringCriteria:""}),B=n([{grade:"一年级",string:"Grade1"},{grade:"二年级",string:"Grade2"},{grade:"三年级",string:"Grade3"},{grade:"四年级",string:"Grade4"},{grade:"五年级",string:"Grade5"},{grade:"六年级",string:"Grade6"},{grade:"初一",string:"Junior1"},{grade:"初二",string:"Junior2"},{grade:"初三",string:"Junior3"},{grade:"高一",string:"Senior1"},{grade:"高二",string:"Senior2"},{grade:"高三",string:"Senior3"}]),R=[{title:"学生",key:"studentName"},{title:"班级",key:"className"},{title:"状态",key:"status"},{title:"分数",key:"score"},{title:"提交时间",key:"submissionDate"},{title:"操作",key:"actions",sortable:!1}],$=G(()=>{if(!_.value)return V.value;const r=_.value.toLowerCase();return V.value.filter(e=>e.studentName.toLowerCase().includes(r)||e.className&&e.className.toLowerCase().includes(r))});async function E(){var r,e;k.value=!0,p.value="";try{const a=await Z(I.value);if(o.value=a,!o.value){p.value="未找到测验信息";return}i.value={id:o.value.id,title:o.value.title,grade:o.value.grade,totalScore:o.value.totalScore,baseScore:o.value.baseScore,scoringCriteria:o.value.scoringCriteria},await J()}catch(a){console.error("获取测验详情失败:",a),p.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"获取测验详情失败"}finally{k.value=!1}}async function J(){D.value=!0;try{const r=await h({assignmentId:I.value}),e=await Promise.all(r.map(async a=>a));V.value=e}catch(r){console.error("获取作文提交列表失败:",r)}finally{D.value=!1}}async function U(){var e,a;const{valid:r}=await L.value.validate();if(r){A.value=!0;try{await ee(o.value.id,i.value),c.value=!1,await E()}catch(z){console.error("保存测验失败:",z),alert(((a=(e=z.response)==null?void 0:e.data)==null?void 0:a.message)||"保存测验失败，请稍后重试")}finally{A.value=!1}}}function N(r){return r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}function j(r){return{Submitted:"已提交",Evaluating:"评测中",Evaluated:"已评测"}[r]||r}function F(r){return{Submitted:"info",Evaluating:"warning",Evaluated:"success"}[r]||"grey"}function P(r){return o.value.totalScore&&r>=o.value.totalScore*.8?"text-success":o.value.totalScore&&r>=o.value.totalScore*.6?"text-warning":"text-error"}return X(()=>{E()}),(r,e)=>(m(),d("div",null,[t(v,{class:"mb-4","prepend-icon":"mdi-arrow-left",variant:"text",to:"/assignments"},{default:l(()=>e[9]||(e[9]=[s("返回测验列表")])),_:1,__:[9]}),k.value?(m(),d("div",ve,[t(te,{indeterminate:"",color:"primary",size:"64"})])):p.value?(m(),d("div",ge,[t(g,{color:"error",size:"64",class:"mb-4"},{default:l(()=>e[10]||(e[10]=[s("mdi-alert-circle")])),_:1,__:[10]}),f("h2",pe,u(p.value),1),t(v,{class:"mt-4",color:"primary",to:"/assignments"},{default:l(()=>e[11]||(e[11]=[s("返回测验列表")])),_:1,__:[11]})])):(m(),d("div",ce,[t(b,{class:"mb-6"},{default:l(()=>[t(T,{class:"text-h5"},{default:l(()=>[s(u(o.value.title),1)]),_:1}),t(y,null,{default:l(()=>[t(ae,null,{default:l(()=>[t(M,{cols:"12",md:"8"},{default:l(()=>[e[12]||(e[12]=f("div",{class:"text-subtitle-1 mb-2"},"评分标准",-1)),t(re,{class:"pa-4 rounded",color:"grey-lighten-4"},{default:l(()=>[f("div",Ve,u(o.value.scoringCriteria||"未设置评分标准"),1)]),_:1})]),_:1,__:[12]}),t(M,{cols:"12",md:"4"},{default:l(()=>[t(se,null,{default:l(()=>[t(x,null,{prepend:l(()=>[t(g,{color:"primary"},{default:l(()=>e[13]||(e[13]=[s("mdi-account-star")])),_:1,__:[13]})]),default:l(()=>[t(C,null,{default:l(()=>e[14]||(e[14]=[s("年级")])),_:1,__:[14]}),t(w,null,{default:l(()=>[s(u(o.value.grade||"未设置"),1)]),_:1})]),_:1}),t(x,null,{prepend:l(()=>[t(g,{color:"primary"},{default:l(()=>e[15]||(e[15]=[s("mdi-star-circle")])),_:1,__:[15]})]),default:l(()=>[t(C,null,{default:l(()=>e[16]||(e[16]=[s("总分 / 基础分")])),_:1,__:[16]}),t(w,null,{default:l(()=>[s(u(o.value.totalScore||"N/A")+" / "+u(o.value.baseScore||"N/A"),1)]),_:1})]),_:1}),t(x,null,{prepend:l(()=>[t(g,{color:"primary"},{default:l(()=>e[17]||(e[17]=[s("mdi-calendar")])),_:1,__:[17]})]),default:l(()=>[t(C,null,{default:l(()=>e[18]||(e[18]=[s("创建时间")])),_:1,__:[18]}),t(w,null,{default:l(()=>[s(u(N(o.value.createdAt)),1)]),_:1})]),_:1}),t(x,null,{prepend:l(()=>[t(g,{color:"primary"},{default:l(()=>e[19]||(e[19]=[s("mdi-calendar-clock")])),_:1,__:[19]})]),default:l(()=>[t(C,null,{default:l(()=>e[20]||(e[20]=[s("更新时间")])),_:1,__:[20]}),t(w,null,{default:l(()=>[s(u(N(o.value.updatedAt)),1)]),_:1})]),_:1})]),_:1}),t(oe,{class:"my-4"}),t(b,{variant:"outlined",class:"mb-4"},{default:l(()=>[t(y,{class:"text-center"},{default:l(()=>[f("div",_e,u(V.value.length),1),e[21]||(e[21]=f("div",{class:"text-subtitle-2"},"作文提交数量",-1))]),_:1,__:[21]})]),_:1}),t(v,{block:"",color:"primary","prepend-icon":"mdi-pencil",onClick:e[0]||(e[0]=a=>c.value=!0)},{default:l(()=>e[22]||(e[22]=[s(" 编辑测验 ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1})]),_:1}),t(b,null,{default:l(()=>[t(T,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[23]||(e[23]=f("span",null,"作文提交列表",-1)),t(S,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),"append-inner-icon":"mdi-magnify",label:"搜索学生","single-line":"","hide-details":"",density:"compact",style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1,__:[23]}),t(y,null,{default:l(()=>[t(ie,{headers:R,items:$.value,loading:D.value,"loading-text":"加载中...","no-data-text":"暂无作文提交"},{"item.status":l(({item:a})=>[t(O,{color:F(a.status),variant:"outlined",size:"small"},{default:l(()=>[s(u(j(a.status)),1)]),_:2},1032,["color"])]),"item.score":l(({item:a})=>[a.status==="Evaluated"?(m(),d("span",{key:0,class:Y(P(a.score))},u(a.score),3)):(m(),d("span",ye,"-"))]),"item.submissionDate":l(({item:a})=>[s(u(N(a.submissionDate)),1)]),"item.actions":l(({item:a})=>[t(v,{icon:"",variant:"text",size:"small",to:`/essays/${a.id}`},{default:l(()=>[t(g,null,{default:l(()=>e[24]||(e[24]=[s("mdi-eye")])),_:1,__:[24]})]),_:2},1032,["to"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(fe,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a),"max-width":"600px"},{default:l(()=>[t(b,null,{default:l(()=>[t(T,{class:"text-h5"},{default:l(()=>e[25]||(e[25]=[s("编辑测验")])),_:1,__:[25]}),t(y,null,{default:l(()=>[t(ue,{ref_key:"form",ref:L,onSubmit:K(U,["prevent"])},{default:l(()=>[t(ne,{modelValue:i.value.grade,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.grade=a),items:B.value,"item-title":"grade","item-value":"string",label:"选择年级",required:""},null,8,["modelValue","items"]),t(S,{modelValue:i.value.title,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.title=a),label:"标题",rules:[a=>!!a||"标题不能为空"],required:""},null,8,["modelValue","rules"]),t(S,{modelValue:i.value.totalScore,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.totalScore=a),label:"总分",type:"number",rules:[a=>a!=null&&a>0||"总分必须大于0"],required:""},null,8,["modelValue","rules"]),t(S,{modelValue:i.value.baseScore,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.baseScore=a),label:"基础分",type:"number",rules:[a=>a!=null&&a>0||"基础分必须大于0"],required:""},null,8,["modelValue","rules"]),t(de,{modelValue:i.value.scoringCriteria,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.scoringCriteria=a),label:"评分标准",rules:[a=>!!a||"评分标准不能为空"],required:"",rows:"5"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),t(le,null,{default:l(()=>[t(me),t(v,{color:"error",variant:"text",onClick:e[7]||(e[7]=a=>c.value=!1)},{default:l(()=>e[26]||(e[26]=[s("取消")])),_:1,__:[26]}),t(v,{color:"primary",onClick:U,loading:A.value},{default:l(()=>e[27]||(e[27]=[s("保存")])),_:1,__:[27]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))]))}});export{Ge as default};
