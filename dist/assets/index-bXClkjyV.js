import{j as se,p as ne,k as q,r,a2 as ie,l as O,a3 as re,q as ue,a4 as de,x as l,y as j,H as f,D as W,E as H,P as ce,Q as ve,d as fe,Y as me,W as pe,X as t,_ as d,$ as D,a5 as ye}from"./index-DrtXJ76k.js";import{V as Ve,b as ke,u as Q,c as ge,d as be}from"./VOverlay-D7KLqul2.js";import{q as we,l as Ce,r as _e,o as L,L as xe,p as Ae,V as p}from"./VAvatar-D6tovhXD.js";import{u as Se,c as X,f as Ie,m as Pe,b as R,V as $,a as Y,d as N,e as G}from"./VTextField-Cbwj9afB.js";import{V as Ee}from"./VDataTable-yaTI-PlP.js";import{V as J,m as De,a as Te}from"./VSelect-DF8LjojY.js";import{V as he}from"./VForm-CzPAKgQp.js";import{V as Ke}from"./VTextarea-Cb3Hx-Wo.js";import{V as Z}from"./VSpacer-B133BwxA.js";import{V as ee}from"./VDialog-BZLPLVZ4.js";import"./scopeId-C9l49y41.js";/* empty css              */const Be=ne({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...Pe(),...De()},"VSwitch"),le=se()({name:"VSwitch",inheritAttrs:!1,props:Be(),emits:{"update:focused":o=>!0,"update:modelValue":o=>!0,"update:indeterminate":o=>!0},setup(o,T){let{attrs:A,slots:i}=T;const c=q(o,"indeterminate"),u=q(o,"modelValue"),{loaderClasses:w}=we(o),{isFocused:C,focus:y,blur:S}=Se(o),I=r(),_=r(),n=ie&&window.matchMedia("(forced-colors: active)").matches,V=O(()=>typeof o.loading=="string"&&o.loading!==""?o.loading:o.color),k=re(),h=O(()=>o.id||`switch-${k}`);function K(){c.value&&(c.value=!1)}function P(m){var g,b;m.stopPropagation(),m.preventDefault(),(b=(g=I.value)==null?void 0:g.input)==null||b.click()}return ue(()=>{const[m,g]=de(A),b=X.filterProps(o),B=J.filterProps(o);return l(X,j({ref:_,class:["v-switch",{"v-switch--flat":o.flat},{"v-switch--inset":o.inset},{"v-switch--indeterminate":c.value},w.value,o.class]},m,b,{modelValue:u.value,"onUpdate:modelValue":s=>u.value=s,id:h.value,focused:C.value,style:o.style}),{...i,default:s=>{let{id:e,messagesId:a,isDisabled:E,isReadonly:ae,isValid:M}=s;const U={model:u,isValid:M};return l(J,j({ref:I},B,{modelValue:u.value,"onUpdate:modelValue":[x=>u.value=x,K],id:e.value,"aria-describedby":a.value,type:"checkbox","aria-checked":c.value?"mixed":void 0,disabled:E.value,readonly:ae.value,onFocus:y,onBlur:S},g),{...i,default:x=>{let{backgroundColorClasses:z,backgroundColorStyles:v}=x;return f("div",{class:H(["v-switch__track",n?void 0:z.value]),style:W(v.value),onClick:P},[i["track-true"]&&f("div",{key:"prepend",class:"v-switch__track-true"},[i["track-true"](U)]),i["track-false"]&&f("div",{key:"append",class:"v-switch__track-false"},[i["track-false"](U)])])},input:x=>{let{inputNode:z,icon:v,backgroundColorClasses:te,backgroundColorStyles:oe}=x;return f(ce,null,[z,f("div",{class:H(["v-switch__thumb",{"v-switch__thumb--filled":v||o.loading},o.inset||n?void 0:te.value]),style:W(o.inset?void 0:oe.value)},[i.thumb?l(Ce,{defaults:{VIcon:{icon:v,size:"x-small"}}},{default:()=>[i.thumb({...U,icon:v})]}):l(_e,null,{default:()=>[o.loading?l(xe,{name:"v-switch",active:!0,color:M.value===!1?void 0:V.value},{default:F=>i.loader?i.loader(F):l(Ae,{active:F.isActive,color:F.color,indeterminate:!0,size:"16",width:"2"},null)}):v&&l(L,{key:String(v),icon:v,size:"x-small"},null)]})])])}})}})}),Ie({},_)}}),Ue={class:"d-flex justify-space-between align-center mb-4"},ze={class:"text-h5"},Xe=ve({__name:"index",setup(o){const T=[{title:"服务类型",key:"serviceType"},{title:"Key",key:"key",sortable:!1},{title:"描述",key:"description"},{title:"启用",key:"isEnabled"},{title:"创建时间",key:"createdAt"},{title:"操作",key:"actions",sortable:!1}],A=r([]),i=r(!1),c=r(!1),u=r(!1),w=r(!1),C=r(!1),y=r(!1),S=r(null),I=["OpenAI","Aliyun","DeepL","Other"],_={id:"",serviceType:"",key:"",secret:"",endpoint:"",description:"",isEnabled:!0},n=r({..._}),V=r(null),k=async()=>{i.value=!0;try{const s=await ke();A.value=s||[]}catch(s){console.error("获取 API 密钥列表失败:",s)}finally{i.value=!1}},h=()=>{y.value=!1,n.value={..._},c.value=!0},K=s=>{y.value=!0,n.value={...s},c.value=!0},P=()=>{c.value=!1},m=async()=>{const{valid:s}=await S.value.validate();if(s){w.value=!0;try{y.value?await Q(n.value.id,n.value):await ge(n.value),P(),await k()}catch(e){console.error("保存 API 密钥失败:",e)}finally{w.value=!1}}},g=s=>{V.value=s,u.value=!0},b=async()=>{if(V.value){C.value=!0;try{await be(V.value.id),u.value=!1,await k()}catch(s){console.error("删除 API 密钥失败:",s)}finally{C.value=!1,V.value=null}}},B=async s=>{const e={...s,isEnabled:!s.isEnabled};try{await Q(s.id,e),await k()}catch(a){console.error("更新密钥状态失败:",a),s.isEnabled=!s.isEnabled}};return fe(()=>{k()}),(s,e)=>(pe(),me("div",null,[f("div",Ue,[e[10]||(e[10]=f("h1",{class:"text-h4"},"API 密钥管理",-1)),l(p,{color:"primary","prepend-icon":"mdi-plus",onClick:h},{default:t(()=>e[9]||(e[9]=[d("新建密钥")])),_:1,__:[9]})]),l($,null,{default:t(()=>[l(R,null,{default:t(()=>[l(Ee,{headers:T,items:A.value,loading:i.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.key":t(({item:a})=>[l(Ve,{label:"",size:"small",class:"font-weight-bold"},{default:t(()=>[d(D(a.key.substring(0,4))+"..."+D(a.key.substring(a.key.length-4)),1)]),_:2},1024)]),"item.isEnabled":t(({item:a})=>[l(le,{"model-value":a.isEnabled,color:"primary","hide-details":"",onChange:E=>B(a)},null,8,["model-value","onChange"])]),"item.createdAt":t(({item:a})=>[d(D(new Date(a.createdAt).toLocaleString()),1)]),"item.actions":t(({item:a})=>[l(p,{icon:"",variant:"text",size:"small",onClick:E=>K(a)},{default:t(()=>[l(L,null,{default:t(()=>e[11]||(e[11]=[d("mdi-pencil")])),_:1,__:[11]})]),_:2},1032,["onClick"]),l(p,{icon:"",variant:"text",size:"small",color:"error",onClick:E=>g(a)},{default:t(()=>[l(L,null,{default:t(()=>e[12]||(e[12]=[d("mdi-delete")])),_:1,__:[12]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),l(ee,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=a=>c.value=a),"max-width":"600px",persistent:""},{default:t(()=>[l($,null,{default:t(()=>[l(Y,null,{default:t(()=>[f("span",ze,D(y.value?"编辑密钥":"新建密钥"),1)]),_:1}),l(R,null,{default:t(()=>[l(he,{ref_key:"form",ref:S,onSubmit:ye(m,["prevent"])},{default:t(()=>[l(Te,{modelValue:n.value.serviceType,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.serviceType=a),items:I,label:"服务类型",rules:[a=>!!a||"请选择服务类型"],required:""},null,8,["modelValue","rules"]),l(N,{modelValue:n.value.key,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.key=a),label:"API Key",rules:[a=>!!a||"API Key 不能为空"],required:""},null,8,["modelValue","rules"]),l(N,{modelValue:n.value.secret,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.secret=a),label:"Secret (可选)",type:"password"},null,8,["modelValue"]),l(N,{modelValue:n.value.endpoint,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.endpoint=a),label:"Endpoint (可选)"},null,8,["modelValue"]),l(Ke,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.description=a),label:"描述 (可选)",rows:"3"},null,8,["modelValue"]),l(le,{modelValue:n.value.isEnabled,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.isEnabled=a),label:"启用",color:"primary"},null,8,["modelValue"])]),_:1},512)]),_:1}),l(G,null,{default:t(()=>[l(Z),l(p,{color:"error",variant:"text",onClick:P},{default:t(()=>e[13]||(e[13]=[d("取消")])),_:1,__:[13]}),l(p,{color:"primary",onClick:m,loading:w.value},{default:t(()=>e[14]||(e[14]=[d("保存")])),_:1,__:[14]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ee,{modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value=a),"max-width":"400px"},{default:t(()=>[l($,null,{default:t(()=>[l(Y,{class:"text-h5"},{default:t(()=>e[15]||(e[15]=[d("确认删除")])),_:1,__:[15]}),l(R,null,{default:t(()=>e[16]||(e[16]=[d("确定要删除这个 API 密钥吗？此操作不可撤销。")])),_:1,__:[16]}),l(G,null,{default:t(()=>[l(Z),l(p,{color:"primary",variant:"text",onClick:e[7]||(e[7]=a=>u.value=!1)},{default:t(()=>e[17]||(e[17]=[d("取消")])),_:1,__:[17]}),l(p,{color:"error",onClick:b,loading:C.value},{default:t(()=>e[18]||(e[18]=[d("删除")])),_:1,__:[18]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Xe as default};
