import{Q as U,r as s,d as j,Y as b,W as T,H as v,x as t,X as l,_ as o,Z as c,aj as D,an as z,a0 as M}from"./index-r3Hix-NK.js";import{z as W,d as q,A as E,B as H}from"./VList-r1kVW96Y.js";import{V as i,p as Q}from"./VAvatar-7zVk-3Er.js";import{b as g,V as k,a as $,c as B}from"./VCard-T3_2Y51s.js";import{V as R}from"./VDataTable-B3ZtoRQK.js";import{V as X}from"./VChip-D6GHusVG.js";import{V as Y}from"./VForm-BqHcEKv4.js";import{V as Z}from"./VTextField-DI4CObfl.js";import{V as S}from"./VSpacer-BUvJUPQP.js";import{V as I}from"./VDialog-fwbItG74.js";import{V as G}from"./VAlert-CYQUUcfo.js";import"./VSelect-BrtmYZuX.js";import"./forwardRefs-TdIUcFqw.js";import"./VOverlay-B79XaCKg.js";import"./dialog-transition-BBGBBMTO.js";/* empty css              */const J={class:"d-flex justify-space-between align-center mb-4"},L={key:0,class:"mt-2"},pe=U({__name:"index",setup(O){const N=[{title:"班级名称",key:"name"},{title:"学生数量",key:"studentCount"},{title:"操作",key:"actions",sortable:!1}],p=s([]),V=s(!1),d=s(!1),m=s(!1),C=s(!1),y=s(!1),w=s(null),f=s({name:""}),r=s(null);async function x(){V.value=!0;try{const n=await W(),e=[];for(const a of n||[])try{const u=await q({classId:a.id});e.push({id:a.id,name:a.name,studentCount:u.length||0})}catch(u){console.error(`获取班级 ${a.name} 的学生数量失败:`,u),e.push({id:a.id,name:a.name,studentCount:0})}p.value=e}catch(n){console.error("获取班级列表失败:",n),p.value=[]}finally{V.value=!1}}async function _(){const{valid:n}=await w.value.validate();if(n){C.value=!0;try{const e={name:f.value.name};await E(e),d.value=!1,await x(),K()}catch(e){console.error("保存班级失败:",e)}finally{C.value=!1}}}function A(n){r.value=n,m.value=!0}async function F(){if(r.value){y.value=!0;try{await H(r.value.id),m.value=!1,await x()}catch(n){console.error("删除班级失败:",n)}finally{y.value=!1,r.value=null}}}function K(){f.value={name:""}}return j(()=>{x()}),(n,e)=>(T(),b("div",null,[v("div",J,[e[7]||(e[7]=v("h1",{class:"text-h4"},"班级管理",-1)),t(i,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=a=>d.value=!0)},{default:l(()=>e[6]||(e[6]=[o("添加班级")])),_:1,__:[6]})]),t(k,null,{default:l(()=>[t(g,null,{default:l(()=>[t(R,{headers:N,items:p.value,loading:V.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.studentCount":l(({item:a})=>[t(X,{color:"primary",variant:"outlined"},{default:l(()=>[o(c(a.studentCount||0),1)]),_:2},1024)]),"item.actions":l(({item:a})=>[t(i,{icon:"",variant:"text",size:"small",color:"error",onClick:u=>A(a)},{default:l(()=>[t(Q,null,{default:l(()=>e[8]||(e[8]=[o("mdi-delete")])),_:1,__:[8]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(I,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),"max-width":"600px"},{default:l(()=>[t(k,null,{default:l(()=>[t($,null,{default:l(()=>e[9]||(e[9]=[v("span",{class:"text-h5"},"添加班级",-1)])),_:1,__:[9]}),t(g,null,{default:l(()=>[t(Y,{ref_key:"form",ref:w,onSubmit:D(_,["prevent"])},{default:l(()=>[t(Z,{modelValue:f.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value.name=a),label:"班级名称",rules:[a=>!!a||"班级名称不能为空"],required:"",onKeyup:z(D(_,["prevent"]),["enter"])},null,8,["modelValue","rules","onKeyup"])]),_:1},512)]),_:1}),t(B,null,{default:l(()=>[t(S),t(i,{color:"error",variant:"text",onClick:e[2]||(e[2]=a=>d.value=!1)},{default:l(()=>e[10]||(e[10]=[o("取消")])),_:1,__:[10]}),t(i,{color:"primary",onClick:_,loading:C.value},{default:l(()=>e[11]||(e[11]=[o("保存")])),_:1,__:[11]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),"max-width":"400px"},{default:l(()=>[t(k,null,{default:l(()=>[t($,{class:"text-h5"},{default:l(()=>e[12]||(e[12]=[o("确认删除")])),_:1,__:[12]}),t(g,null,{default:l(()=>{var a;return[e[13]||(e[13]=o(" 确定要删除班级 ")),v("strong",null,c((a=r.value)==null?void 0:a.name),1),e[14]||(e[14]=o(" 吗？此操作不可撤销。 ")),r.value&&r.value.studentCount>0?(T(),b("div",L,[t(G,{type:"warning",variant:"tonal",density:"compact"},{default:l(()=>{var u;return[o(" 注意：该班级下有 "+c((u=r.value)==null?void 0:u.studentCount)+" 名学生，删除班级将导致这些学生失去班级关联。 ",1)]}),_:1})])):M("",!0)]}),_:1,__:[13,14]}),t(B,null,{default:l(()=>[t(S),t(i,{color:"primary",variant:"text",onClick:e[4]||(e[4]=a=>m.value=!1)},{default:l(()=>e[15]||(e[15]=[o("取消")])),_:1,__:[15]}),t(i,{color:"error",onClick:F,loading:y.value},{default:l(()=>e[16]||(e[16]=[o("删除")])),_:1,__:[16]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{pe as default};
