import{Q as x,R as C,r as l,V as v,W as s,X as t,x as r,_ as m,a0 as b,an as N,Y as n,Z as _,P as T,$ as U}from"./index-B1k2TmTq.js";import{n as h,V as y,D as A}from"./VAvatar-60eLK1cy.js";import{a as B,V as D}from"./VRow-DDqpY3dd.js";import{V as F,b as S,c as R}from"./VCard-DzPeIVHj.js";import{V as j,a as q}from"./VToolbar-D8NhLrTb.js";import{V as K}from"./VForm-D1wVrR7W.js";import{V as g}from"./VTextField-B5o9k15D.js";import{V as P}from"./VAlert-D60Ja8ie.js";import{V as E}from"./VSpacer-hqQAeQtU.js";import{V as I}from"./VContainer-Dteauxso.js";/* empty css              */import"./forwardRefs-TdIUcFqw.js";const L={key:0},Q={key:1},re=x({__name:"login",setup(W){const k=C(),p=h(),u=l(""),i=l(""),d=l(!1),o=l(""),f=l(null);async function V(){const{valid:c}=await f.value.validate();if(c){d.value=!0,o.value="";try{const e=new FormData;e.append("Username",u.value),e.append("Password",i.value);const a=await A.post("/api/Auth/login",e);p.setUserInfo({token:a.data.token,name:a.data.user.name,phoneNumber:a.data.user.phoneNumber||""}),p.setUserName(a.data.user.username),k.push("/")}catch(e){console.error("登录失败:",e),e.response?e.response.data.errors?o.value=e.response.data.errors:o.value=e.response.data.message||"登录失败，请检查用户名和密码":o.value="网络错误，请稍后重试"}finally{d.value=!1}}}return(c,e)=>(s(),v(I,{class:"fill-height",fluid:""},{default:t(()=>[r(B,{align:"center",justify:"center"},{default:t(()=>[r(D,{cols:"12",sm:"8",md:"6",lg:"4"},{default:t(()=>[r(F,{class:"elevation-12"},{default:t(()=>[r(j,{color:"primary",dark:""},{default:t(()=>[r(q,null,{default:t(()=>e[2]||(e[2]=[m("登录")])),_:1,__:[2]})]),_:1}),r(S,null,{default:t(()=>[r(K,{onKeyup:N(V,["enter"]),ref_key:"form",ref:f},{default:t(()=>[r(g,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),label:"用户名",name:"username","prepend-icon":"mdi-account",type:"text",rules:[a=>!!a||"用户名不能为空"],required:""},null,8,["modelValue","rules"]),r(g,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),label:"密码",name:"password","prepend-icon":"mdi-lock",type:"password",rules:[a=>!!a||"密码不能为空"],required:""},null,8,["modelValue","rules"])]),_:1},512),o.value?(s(),v(P,{key:0,type:"error",variant:"tonal",class:"mt-4"},{default:t(()=>[typeof o.value=="string"?(s(),n("div",L,_(o.value),1)):(s(),n("ul",Q,[(s(!0),n(T,null,U(o.value,(a,w)=>(s(),n("li",{key:w},_(a.join(", ")),1))),128))]))]),_:1})):b("",!0)]),_:1}),r(R,null,{default:t(()=>[r(E),r(y,{to:"/register",variant:"text"},{default:t(()=>e[3]||(e[3]=[m("注册账号")])),_:1,__:[3]}),r(y,{color:"primary",onClick:V,loading:d.value},{default:t(()=>e[4]||(e[4]=[m("登录")])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{re as default};
