import{Q as I,r as n,d as M,Y as L,W as Q,H as V,x as t,X as a,_ as i,Z as k,aj as W}from"./index-B1k2TmTq.js";import{c as X,q as Y,r as Z,v as G}from"./VList-DXkKCcoE.js";import{V as s,p as c}from"./VAvatar-60eLK1cy.js";import{b as x,V as C,a as _,c as A}from"./VCard-DzPeIVHj.js";import{V as J}from"./VDataTable-NCjCFB7Z.js";import{V as K}from"./VForm-D1wVrR7W.js";import{e as O}from"./VSelect-bMY2wi1p.js";import{V as D}from"./VTextField-B5o9k15D.js";import{V as y}from"./VTextarea-Ri4nZl35.js";import{V as T}from"./VSpacer-hqQAeQtU.js";import{V as U}from"./VDialog-VYq4SPpl.js";import"./VChip-m9RGjYNR.js";import"./forwardRefs-TdIUcFqw.js";import"./VOverlay-C_Thq67v.js";import"./dialog-transition-BtpIEwcb.js";/* empty css              */const P={class:"d-flex justify-space-between align-center mb-4"},R={class:"text-h5"},Ve=I({__name:"index",setup(h){function $(r){const e={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},l=new Date(r);return l.setHours(l.getHours()+8),l.toLocaleString(void 0,e)}const v=n(!1),u=n(!1),q=[{title:"描述",key:"description"},{title:"年级",key:"grade"},{title:"创建时间",key:"createdAt"},{title:"操作",key:"actions",sortable:!1}],b=n([]),d=n(!1),f=n(!1),p=n(!1),m=n(!1),S=n(null),B=n([{grade:"一年级",string:"一年级"},{grade:"二年级",string:"二年级"},{grade:"三年级",string:"三年级"},{grade:"四年级",string:"四年级"},{grade:"五年级",string:"五年级"},{grade:"六年级",string:"六年级"},{grade:"初一",string:"初一"},{grade:"初二",string:"初二"},{grade:"初三",string:"初三"},{grade:"高一",string:"高一"},{grade:"高二",string:"高二"},{grade:"高三",string:"高三"}]),o=n({id:"",grade:null,totalScore:null,baseScore:null,description:"",scoringCriteria:"",titleContext:""}),g=n(null),z=r=>{g.value=r,d.value=!0},F=r=>{m.value=!0,o.value={id:r.id,grade:r.grade||null,totalScore:r.totalScore||null,baseScore:r.baseScore||null,scoringCriteria:r.scoringCriteria||"",description:r.description||null,titleContext:r.titleContext||null},u.value=!0},H=async()=>{v.value=!0;try{const r=await X();b.value=r||[]}catch(r){console.error("获取测验列表失败:",r)}finally{v.value=!1}},w=async()=>{const{valid:r}=await S.value.validate();if(r){f.value=!0;try{const e={scoringCriteria:o.value.scoringCriteria,grade:o.value.grade||void 0,totalScore:o.value.totalScore||void 0,baseScore:o.value.baseScore||void 0,titleContext:o.value.titleContext||void 0,description:o.value.description||void 0};m.value?await Y(o.value.id,e):await Z(e),u.value=!1,window.location.reload(),j()}catch(e){console.error("保存测验失败:",e)}finally{f.value=!1}}},N=async()=>{if(g.value){p.value=!0;try{await G(g.value.id),d.value=!1,window.location.reload()}catch(r){console.error("删除测验失败:",r)}finally{p.value=!1,g.value=null}}},j=()=>{m.value=!1,o.value={id:"",grade:null,totalScore:null,baseScore:null,scoringCriteria:"",description:"",titleContext:""}};return M(()=>{H()}),(r,e)=>(Q(),L("div",null,[V("div",P,[e[12]||(e[12]=V("h1",{class:"text-h4"},"测验管理",-1)),t(s,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>u.value=!0)},{default:a(()=>e[11]||(e[11]=[i("新建测验")])),_:1,__:[11]})]),t(C,null,{default:a(()=>[t(x,null,{default:a(()=>[t(J,{headers:q,items:b.value,loading:v.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.createdAt":a(({item:l})=>[i(k($(l.createdAt)),1)]),"item.actions":a(({item:l})=>[t(s,{icon:"",variant:"text",size:"small",to:`/assignments/${l.id}`},{default:a(()=>[t(c,null,{default:a(()=>e[13]||(e[13]=[i("mdi-eye")])),_:1,__:[13]})]),_:2},1032,["to"]),t(s,{icon:"",variant:"text",size:"small",onClick:E=>F(l)},{default:a(()=>[t(c,null,{default:a(()=>e[14]||(e[14]=[i("mdi-pencil")])),_:1,__:[14]})]),_:2},1032,["onClick"]),t(s,{icon:"",variant:"text",size:"small",color:"error",onClick:E=>z(l)},{default:a(()=>[t(c,null,{default:a(()=>e[15]||(e[15]=[i("mdi-delete")])),_:1,__:[15]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(U,{modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value=l),"max-width":"600px"},{default:a(()=>[t(C,null,{default:a(()=>[t(_,null,{default:a(()=>[V("span",R,k(m.value?"编辑测验":"新建测验"),1)]),_:1}),t(x,null,{default:a(()=>[t(K,{ref_key:"form",ref:S,onSubmit:W(w,["prevent"])},{default:a(()=>[t(O,{modelValue:o.value.grade,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.grade=l),items:B.value,"item-title":"grade","item-value":"string",label:"选择年级",required:""},null,8,["modelValue","items"]),t(D,{modelValue:o.value.totalScore,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.totalScore=l),label:"总分",type:"number",rules:[l=>l!=null&&l>0||"总分必须大于0"],required:""},null,8,["modelValue","rules"]),t(D,{modelValue:o.value.baseScore,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.baseScore=l),label:"基础分",type:"number",rules:[l=>l!=null&&l>0||"基础分必须大于0"],required:""},null,8,["modelValue","rules"]),t(y,{modelValue:o.value.titleContext,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.titleContext=l),label:"标题",rows:"5"},null,8,["modelValue"]),t(y,{modelValue:o.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.description=l),label:"描述",rows:"5"},null,8,["modelValue"]),t(y,{modelValue:o.value.scoringCriteria,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.scoringCriteria=l),label:"评分标准",rows:"5"},null,8,["modelValue"])]),_:1},512)]),_:1}),t(A,null,{default:a(()=>[t(T),t(s,{color:"error",variant:"text",onClick:e[7]||(e[7]=l=>u.value=!1)},{default:a(()=>e[16]||(e[16]=[i("取消")])),_:1,__:[16]}),t(s,{color:"primary",onClick:w,loading:f.value},{default:a(()=>e[17]||(e[17]=[i("保存")])),_:1,__:[17]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:d.value,"onUpdate:modelValue":e[10]||(e[10]=l=>d.value=l),"max-width":"400px"},{default:a(()=>[t(C,null,{default:a(()=>[t(_,{class:"text-h5"},{default:a(()=>e[18]||(e[18]=[i("确认删除")])),_:1,__:[18]}),t(x,null,{default:a(()=>e[19]||(e[19]=[i("确定要删除这个测验吗？此操作不可撤销。")])),_:1,__:[19]}),t(A,null,{default:a(()=>[t(T),t(s,{color:"primary",variant:"text",onClick:e[9]||(e[9]=l=>d.value=!1)},{default:a(()=>e[20]||(e[20]=[i("取消")])),_:1,__:[20]}),t(s,{color:"error",onClick:N,loading:p.value},{default:a(()=>e[21]||(e[21]=[i("删除")])),_:1,__:[21]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Ve as default};
