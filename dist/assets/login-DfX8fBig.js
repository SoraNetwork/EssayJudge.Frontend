import{Q as x,R as C,r as l,V as v,W as s,X as t,x as r,_ as m,ab as b,aa as N,Y as n,$ as _,P as T,Z as U}from"./index-DrtXJ76k.js";import{n as h,V as y}from"./VAvatar-D6tovhXD.js";import{V as A,b as B,d as g,e as F,k as S}from"./VTextField-Cbwj9afB.js";import{a as D,V as R}from"./VRow-9Ta8N-Ip.js";import{V as j,a as q}from"./VToolbar-Coa4CNzf.js";import{V as K}from"./VForm-CzPAKgQp.js";import{V as P}from"./VAlert-DwnNhemx.js";import{V as E}from"./VSpacer-B133BwxA.js";import{V as I}from"./VContainer-Bmf_UuCc.js";/* empty css              */const L={key:0},Q={key:1},ee=x({__name:"login",setup(W){const k=C(),p=h(),u=l(""),i=l(""),d=l(!1),o=l(""),f=l(null);async function V(){const{valid:c}=await f.value.validate();if(c){d.value=!0,o.value="";try{const e=new FormData;e.append("Username",u.value),e.append("Password",i.value);const a=await S.post("/api/Auth/login",e);p.setUserInfo({token:a.data.token,name:a.data.user.name,phoneNumber:a.data.user.phoneNumber||""}),p.setUserName(a.data.user.username),k.push("/")}catch(e){console.error("登录失败:",e),e.response?e.response.data.errors?o.value=e.response.data.errors:o.value=e.response.data.message||"登录失败，请检查用户名和密码":o.value="网络错误，请稍后重试"}finally{d.value=!1}}}return(c,e)=>(s(),v(I,{class:"fill-height",fluid:""},{default:t(()=>[r(D,{align:"center",justify:"center"},{default:t(()=>[r(R,{cols:"12",sm:"8",md:"6",lg:"4"},{default:t(()=>[r(A,{class:"elevation-12"},{default:t(()=>[r(j,{color:"primary",dark:""},{default:t(()=>[r(q,null,{default:t(()=>e[2]||(e[2]=[m("登录")])),_:1,__:[2]})]),_:1}),r(B,null,{default:t(()=>[r(K,{onKeyup:N(V,["enter"]),ref_key:"form",ref:f},{default:t(()=>[r(g,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),label:"用户名",name:"username","prepend-icon":"mdi-account",type:"text",rules:[a=>!!a||"用户名不能为空"],required:""},null,8,["modelValue","rules"]),r(g,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),label:"密码",name:"password","prepend-icon":"mdi-lock",type:"password",rules:[a=>!!a||"密码不能为空"],required:""},null,8,["modelValue","rules"])]),_:1},512),o.value?(s(),v(P,{key:0,type:"error",variant:"tonal",class:"mt-4"},{default:t(()=>[typeof o.value=="string"?(s(),n("div",L,_(o.value),1)):(s(),n("ul",Q,[(s(!0),n(T,null,U(o.value,(a,w)=>(s(),n("li",{key:w},_(a.join(", ")),1))),128))]))]),_:1})):b("",!0)]),_:1}),r(F,null,{default:t(()=>[r(E),r(y,{to:"/register",variant:"text"},{default:t(()=>e[3]||(e[3]=[m("注册账号")])),_:1,__:[3]}),r(y,{color:"primary",onClick:V,loading:d.value},{default:t(()=>e[4]||(e[4]=[m("登录")])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{ee as default};
