import{Q as E,r as s,d as M,Y as $,W as D,H as p,x as t,X as a,_ as o,$ as C,a5 as T,aa as W,ab as q}from"./index-DrtXJ76k.js";import{V as H,j as Q,a as R,k as X,l as Y,m as G}from"./VOverlay-D7KLqul2.js";import{V as d,o as I}from"./VAvatar-D6tovhXD.js";import{b as k,V as w,a as S,d as J,e as B}from"./VTextField-Cbwj9afB.js";import{V as L}from"./VDataTable-yaTI-PlP.js";import{V as O}from"./VForm-CzPAKgQp.js";import{V as N}from"./VSpacer-B133BwxA.js";import{V as F}from"./VDialog-BZLPLVZ4.js";import{V as P}from"./VAlert-DwnNhemx.js";import"./scopeId-C9l49y41.js";import"./VSelect-DF8LjojY.js";/* empty css              */const Z={class:"d-flex justify-space-between align-center mb-4"},h={class:"text-h5"},ee={key:0,class:"mt-2"},pe=E({__name:"index",setup(te){const K=[{title:"班级名称",key:"name"},{title:"学生数量",key:"studentCount"},{title:"操作",key:"actions",sortable:!1}],V=s([]),c=s(!1),f=s(!1),m=s(!1),y=s(!1),_=s(!1),v=s(!1),b=s(null),i=s({id:"",name:""}),u=s(null);async function x(){c.value=!0;try{const n=await Q(),e=[];for(const l of n||[])try{const r=await R({classId:l.id});e.push({id:l.id,name:l.name,studentCount:r.length||0})}catch(r){console.error(`获取班级 ${l.name} 的学生数量失败:`,r),e.push({id:l.id,name:l.name,studentCount:0})}V.value=e}catch(n){console.error("获取班级列表失败:",n),V.value=[]}finally{c.value=!1}}function U(n){v.value=!0,i.value={...n},f.value=!0}async function g(){const{valid:n}=await b.value.validate();if(n){y.value=!0;try{const e={name:i.value.name};if(v.value){if(!i.value.id){console.error("Cannot update class without an ID");return}await X(i.value.id,e)}else await Y(e);f.value=!1,await x(),A()}catch(e){console.error("保存班级失败:",e)}finally{y.value=!1}}}function j(n){u.value=n,m.value=!0}async function z(){if(u.value){_.value=!0;try{await G(u.value.id),m.value=!1,await x()}catch(n){console.error("删除班级失败:",n)}finally{_.value=!1,u.value=null}}}function A(){v.value=!1,i.value={id:"",name:""}}return M(()=>{x()}),(n,e)=>(D(),$("div",null,[p("div",Z,[e[7]||(e[7]=p("h1",{class:"text-h4"},"班级管理",-1)),t(d,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>f.value=!0)},{default:a(()=>e[6]||(e[6]=[o("添加班级")])),_:1,__:[6]})]),t(w,null,{default:a(()=>[t(k,null,{default:a(()=>[t(L,{headers:K,items:V.value,loading:c.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.studentCount":a(({item:l})=>[t(H,{color:"primary",variant:"outlined"},{default:a(()=>[o(C(l.studentCount||0),1)]),_:2},1024)]),"item.actions":a(({item:l})=>[t(d,{icon:"",variant:"text",size:"small",onClick:r=>U(l)},{default:a(()=>[t(I,null,{default:a(()=>e[8]||(e[8]=[o("mdi-pencil")])),_:1,__:[8]})]),_:2},1032,["onClick"]),t(d,{icon:"",variant:"text",size:"small",color:"error",onClick:r=>j(l)},{default:a(()=>[t(I,null,{default:a(()=>e[9]||(e[9]=[o("mdi-delete")])),_:1,__:[9]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(F,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),"max-width":"600px"},{default:a(()=>[t(w,null,{default:a(()=>[t(S,null,{default:a(()=>[p("span",h,C(v.value?"编辑班级":"添加班级"),1)]),_:1}),t(k,null,{default:a(()=>[t(O,{ref_key:"form",ref:b,onSubmit:T(g,["prevent"])},{default:a(()=>[t(J,{modelValue:i.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.name=l),label:"班级名称",rules:[l=>!!l||"班级名称不能为空"],required:"",onKeyup:W(T(g,["prevent"]),["enter"])},null,8,["modelValue","rules","onKeyup"])]),_:1},512)]),_:1}),t(B,null,{default:a(()=>[t(N),t(d,{color:"error",variant:"text",onClick:e[2]||(e[2]=l=>f.value=!1)},{default:a(()=>e[10]||(e[10]=[o("取消")])),_:1,__:[10]}),t(d,{color:"primary",onClick:g,loading:y.value},{default:a(()=>e[11]||(e[11]=[o("保存")])),_:1,__:[11]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(F,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value=l),"max-width":"400px"},{default:a(()=>[t(w,null,{default:a(()=>[t(S,{class:"text-h5"},{default:a(()=>e[12]||(e[12]=[o("确认删除")])),_:1,__:[12]}),t(k,null,{default:a(()=>{var l;return[e[13]||(e[13]=o(" 确定要删除班级 ")),p("strong",null,C((l=u.value)==null?void 0:l.name),1),e[14]||(e[14]=o(" 吗？此操作不可撤销。 ")),u.value&&u.value.studentCount>0?(D(),$("div",ee,[t(P,{type:"warning",variant:"tonal",density:"compact"},{default:a(()=>{var r;return[o(" 注意：该班级下有 "+C((r=u.value)==null?void 0:r.studentCount)+" 名学生，删除班级将导致这些学生失去班级关联。 ",1)]}),_:1})])):q("",!0)]}),_:1,__:[13,14]}),t(B,null,{default:a(()=>[t(N),t(d,{color:"primary",variant:"text",onClick:e[4]||(e[4]=l=>m.value=!1)},{default:a(()=>e[15]||(e[15]=[o("取消")])),_:1,__:[15]}),t(d,{color:"error",onClick:z,loading:_.value},{default:a(()=>e[16]||(e[16]=[o("删除")])),_:1,__:[16]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{pe as default};
