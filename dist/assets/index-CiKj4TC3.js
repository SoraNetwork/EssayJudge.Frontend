import{s as T,c as E,d as N,C as H}from"./VList-DXkKCcoE.js";import{V as d,p as g}from"./VAvatar-60eLK1cy.js";import{b as V,V as _}from"./VCard-DzPeIVHj.js";import{a as z,V as c}from"./VRow-DDqpY3dd.js";import{e as b}from"./VSelect-bMY2wi1p.js";import{V as A}from"./VDataTable-NCjCFB7Z.js";import{V as F}from"./VTooltip-nvP2PkPG.js";import{V as U}from"./VChip-m9RGjYNR.js";import{Q as $,r as s,d as j,Y as S,W as f,H as k,x as l,X as o,_ as n,V as L,Z as x}from"./index-B1k2TmTq.js";/* empty css              */import"./VTextField-B5o9k15D.js";import"./forwardRefs-TdIUcFqw.js";import"./VOverlay-C_Thq67v.js";import"./dialog-transition-BtpIEwcb.js";const M={class:"d-flex justify-space-between align-center mb-4"},Q={key:1},ne=$({__name:"index",setup(R){function C(e){const t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},a=new Date(e);return a.setHours(a.getHours()+8),a.toLocaleString(void 0,t)}const w=[{title:"学生姓名",key:"studentName"},{title:"测验题目",key:"assignmentTitle"},{title:"提交时间",key:"submissionDate"},{title:"得分",key:"finalScore"},{title:"操作",key:"actions",sortable:!1}],p=s([]),v=s([]),y=s([]),u=s(!1),m=s(""),i=s({assignmentId:void 0,studentId:void 0});async function r(){u.value=!0;try{const e=await T(i.value);p.value=e||[]}catch(e){console.error("获取作文列表失败:",e)}finally{u.value=!1}}function D(e){if(e!=null)return e>=90?"green":e>=75?"light-green":e>=60?"orange":"red"}async function I(){try{const e=await E();v.value=e||[]}catch(e){console.error("获取测验列表失败:",e)}}async function h(){try{const e=await N({});y.value=e||[]}catch(e){console.error("获取学生列表失败:",e)}}async function B(e){m.value=e.id;try{await H(e.id),await r()}catch(t){console.error("提交评测失败:",t)}finally{m.value=""}}return j(()=>{r(),I(),h()}),(e,t)=>(f(),S("div",null,[k("div",M,[t[3]||(t[3]=k("h1",{class:"text-h4"},"作文管理",-1)),l(d,{color:"primary",to:"/essays/upload","prepend-icon":"mdi-upload"},{default:o(()=>t[2]||(t[2]=[n(" 上传批改 ")])),_:1,__:[2]})]),l(_,{class:"mb-4"},{default:o(()=>[l(V,null,{default:o(()=>[l(z,null,{default:o(()=>[l(c,{cols:"12",md:"4"},{default:o(()=>[l(b,{modelValue:i.value.assignmentId,"onUpdate:modelValue":[t[0]||(t[0]=a=>i.value.assignmentId=a),r],label:"测验题目",items:v.value,"item-title":"title","item-value":"id",clearable:""},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",md:"4"},{default:o(()=>[l(b,{modelValue:i.value.studentId,"onUpdate:modelValue":[t[1]||(t[1]=a=>i.value.studentId=a),r],label:"学生",items:y.value,"item-title":"name","item-value":"id",clearable:""},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",md:"4"},{default:o(()=>[l(d,{color:"primary",onClick:r,"prepend-icon":"mdi-refresh"},{default:o(()=>t[4]||(t[4]=[n(" 刷新 ")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1})]),_:1}),l(_,null,{default:o(()=>[l(V,null,{default:o(()=>[l(A,{headers:w,items:p.value,loading:u.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.submissionDate":o(({item:a})=>[n(x(C(a.submissionDate)),1)]),"item.finalScore":o(({item:a})=>[a.finalScore!==null&&a.finalScore!==void 0?(f(),L(U,{key:0,color:D(a.finalScore),"text-color":"white"},{default:o(()=>[n(x(a.finalScore),1)]),_:2},1032,["color"])):(f(),S("span",Q,"未评分"))]),"item.actions":o(({item:a})=>[l(d,{icon:"",variant:"text",size:"small",to:`/essays/${a.id}`},{default:o(()=>[l(g,null,{default:o(()=>t[5]||(t[5]=[n("mdi-eye")])),_:1,__:[5]})]),_:2},1032,["to"]),l(d,{icon:"",variant:"text",size:"small",color:"primary",onClick:W=>B(a),disabled:a.finalScore!==null&&a.finalScore!==void 0,loading:m.value===a.id},{default:o(()=>[l(g,null,{default:o(()=>t[6]||(t[6]=[n("mdi-check-circle")])),_:1,__:[6]}),l(F,{activator:"parent",location:"top"},{default:o(()=>t[7]||(t[7]=[n("提交评测")])),_:1,__:[7]})]),_:2},1032,["onClick","disabled","loading"])]),_:1},8,["items","loading"])]),_:1})]),_:1})]))}});export{ne as default};
