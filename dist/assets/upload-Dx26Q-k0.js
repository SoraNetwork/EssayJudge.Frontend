import{Q as F,R as M,r as o,d as N,Y as c,W as n,H as i,V as R,a0 as V,X as t,x as a,a6 as q,_ as d,Z as p,P as A,$ as U}from"./index--uryIc9t.js";import{c as E,y as j,w as D}from"./VList-Bw5JRA7I.js";import{b as g,V as y,a as I}from"./VCard-Baw6fKXM.js";import{V as L}from"./VForm-E8O1qvQD.js";import{a as $}from"./VSelect-C7-6oE3D.js";import{V as h}from"./VFileInput-DFMlOF51.js";import{a as z}from"./VTextField-B7WNoRZT.js";import{V as T,v as H,q as Q}from"./VAvatar-Cjt3-t6c.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./forwardRefs-TdIUcFqw.js";import"./VOverlay-CaEAIGL2.js";import"./dialog-transition-C45ZtiWV.js";import"./VChip-CTpQQSB7.js";const X={class:"d-flex justify-end"},Y={key:1},Z=F({__name:"upload",setup(G){const w=M(),C=o([]),v=o(null),f=o(null),_=o(3),b=o(!1),x=o(!1),m=o(!1),s=o({}),r=o(0);async function S(){try{const u=await E();C.value=u||[]}catch(u){console.error("获取测验列表失败:",u)}}async function B(){if(!(!v.value||!f.value)){b.value=!0,x.value=!0,r.value=0;try{const e=(await j(v.value,f.value,_.value)).submissionId;P(e)}catch(u){console.error("上传作文失败:",u),m.value=!1,r.value=0}finally{b.value=!1}}}function P(u){x.value=!1,m.value=!0,r.value=0;const e=setInterval(async()=>{try{const l=await D(u);s.value=l;let k=0;s.value.parsedText&&(k+=20),s.value.aiResults&&s.value.aiResults.length>0&&(k+=Math.min(s.value.aiResults.length,4)*20),r.value=Math.min(k,100),l.judgeResult&&(clearInterval(e),r.value=100,setTimeout(()=>{w.push(`/essays/${u}`)},500))}catch(l){console.error("轮询失败:",l),clearInterval(e),m.value=!1,s.value={},r.value=0}},2e3)}return N(()=>{S()}),(u,e)=>(n(),c("div",null,[e[8]||(e[8]=i("h1",{class:"text-h4 mb-4"},"上传作文并批改",-1)),!x.value&&!m.value?(n(),R(y,{key:0},{default:t(()=>[a(g,null,{default:t(()=>[a(L,{onSubmit:q(B,["prevent"])},{default:t(()=>[a($,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),items:C.value,"item-title":"title","item-value":"id",label:"选择测验",required:""},null,8,["modelValue","items"]),a(h,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),label:"选择作文图片（支持拖动文件到此处选择）",accept:"image/*",required:""},null,8,["modelValue"]),a(z,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),modelModifiers:{number:!0},label:"分栏数",type:"number",required:""},null,8,["modelValue"]),i("div",X,[a(T,{type:"submit",color:"primary",loading:b.value,class:"mr-2"},{default:t(()=>e[3]||(e[3]=[d("提交")])),_:1,__:[3]},8,["loading"]),a(T,{color:"secondary",to:"/essays/upload_multiple","prepend-icon":"mdi-upload-multiple"},{default:t(()=>e[4]||(e[4]=[d("批量上传")])),_:1,__:[4]})])]),_:1})]),_:1})]),_:1})):V("",!0),m.value?(n(),c("div",Y,[a(H,{"model-value":r.value,color:"primary",height:"8",striped:"",class:"mb-4"},null,8,["model-value"]),a(y,{class:"mb-4"},{default:t(()=>[a(g,{class:"text-center"},{default:t(()=>[a(Q,{indeterminate:"",color:"primary",size:"64"}),e[5]||(e[5]=i("p",{class:"mt-4"},"正在批改中，请稍候...",-1)),i("p",null,"状态: "+p(s.value.status),1)]),_:1,__:[5]})]),_:1}),s.value.parsedText?(n(),R(y,{key:0,class:"mb-4"},{default:t(()=>[a(I,null,{default:t(()=>e[6]||(e[6]=[d("识别原文")])),_:1,__:[6]}),a(g,{class:"pre-wrap"},{default:t(()=>[d(p(s.value.parsedText),1)]),_:1})]),_:1})):V("",!0),s.value.aiResults&&s.value.aiResults.length>0?(n(),R(y,{key:1,class:"mb-4"},{default:t(()=>[a(I,null,{default:t(()=>e[7]||(e[7]=[d("AI 初步批改")])),_:1,__:[7]}),a(g,null,{default:t(()=>[i("ul",null,[(n(!0),c(A,null,U(s.value.aiResults,l=>(n(),c("li",{key:l.id},[i("strong",null,p(l.modelName)+":",1),d(" "+p(l.feedback)+" (得分: "+p(l.score)+") ",1)]))),128))])]),_:1})]),_:1})):V("",!0)])):V("",!0)]))}}),de=W(Z,[["__scopeId","data-v-407a1ec9"]]);export{de as default};
