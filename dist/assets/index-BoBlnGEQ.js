import{Q as A,r as n,d as G,Y as Q,W as R,H as p,x as l,X as a,_ as o,an as W,Z as S,aj as X}from"./index-r3Hix-NK.js";import{z as Y,d as Z,G as J,H as L,I as O}from"./VList-r1kVW96Y.js";import{V as r,p as U}from"./VAvatar-7zVk-3Er.js";import{b as V,V as c,a as D,c as $}from"./VCard-T3_2Y51s.js";import{a as P,V as k}from"./VRow-DQMQoz0H.js";import{e as B}from"./VSelect-BrtmYZuX.js";import{V as b}from"./VTextField-DI4CObfl.js";import{V as h}from"./VDataTable-B3ZtoRQK.js";import{V as ee}from"./VForm-BqHcEKv4.js";import{V as N}from"./VSpacer-BUvJUPQP.js";import{V as q}from"./VDialog-fwbItG74.js";/* empty css              */import"./forwardRefs-TdIUcFqw.js";import"./VOverlay-B79XaCKg.js";import"./dialog-transition-BBGBBMTO.js";import"./VChip-D6GHusVG.js";const le={class:"d-flex justify-space-between align-center mb-4"},ae={class:"text-h5"},Ce=A({__name:"index",setup(te){const z=[{title:"姓名",key:"name"},{title:"学号",key:"studentId"},{title:"班级",key:"className"},{title:"操作",key:"actions",sortable:!1}],w=n([]),I=n([]),y=n(!1),i=n(!1),f=n(!1),x=n(!1),C=n(!1),g=n(!1),_=n(null),d=n({classId:null,searchTerm:""}),u=n({id:"",name:"",studentId:"",classId:null}),v=n(null);async function m(){y.value=!0;try{const s={};d.value.classId!==null&&d.value.classId!==void 0&&(s.classId=d.value.classId),d.value.searchTerm&&(s.searchTerm=d.value.searchTerm);const e=await Z(s);w.value=e||[]}catch(s){console.error("获取学生列表失败:",s)}finally{y.value=!1}}function E(){u.value={id:"",name:"",studentId:"",classId:null}}function F(s){g.value=!0,u.value={...s,classId:s.classId||null},i.value=!0}function j(s){v.value=s,f.value=!0}async function T(){if(!_.value)return;const{valid:s}=await _.value.validate();if(s){x.value=!0;try{if(g.value){if(!u.value.id){console.error("Cannot update student without an ID.");return}const e={name:u.value.name,studentId:u.value.studentId};u.value.classId!==null&&(e.classId=u.value.classId),await J(u.value.id,e)}else{const e={name:u.value.name,studentId:u.value.studentId};u.value.classId!==null&&(e.classId=u.value.classId),await L(e)}i.value=!1,E(),m()}catch(e){console.error("保存学生失败:",e)}finally{x.value=!1}}}async function H(){if(v.value){C.value=!0;try{await O(v.value.id),f.value=!1,v.value=null,m()}catch(s){console.error("删除学生失败:",s)}finally{C.value=!1}}}G(()=>{K(),m()});async function K(){try{const s=await Y();I.value=s||[]}catch(s){console.error("获取班级列表失败:",s)}}return(s,e)=>(R(),Q("div",null,[p("div",le,[e[11]||(e[11]=p("h1",{class:"text-h4"},"学生管理",-1)),l(r,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=t=>i.value=!0)},{default:a(()=>e[10]||(e[10]=[o("添加学生")])),_:1,__:[10]})]),l(c,{class:"mb-4"},{default:a(()=>[l(V,null,{default:a(()=>[l(P,null,{default:a(()=>[l(k,{cols:"12",md:"4"},{default:a(()=>[l(B,{modelValue:d.value.classId,"onUpdate:modelValue":[e[1]||(e[1]=t=>d.value.classId=t),m],label:"班级",items:I.value,"item-title":"name","item-value":"id",clearable:""},null,8,["modelValue","items"])]),_:1}),l(k,{cols:"12",md:"4"},{default:a(()=>[l(b,{modelValue:d.value.searchTerm,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.searchTerm=t),label:"搜索学生","prepend-icon":"mdi-magnify",clearable:"",onKeyup:W(m,["enter"])},null,8,["modelValue"])]),_:1}),l(k,{cols:"12",md:"4"},{default:a(()=>[l(r,{color:"primary",onClick:m,"prepend-icon":"mdi-refresh"},{default:a(()=>e[12]||(e[12]=[o(" 刷新 ")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})]),_:1}),l(c,null,{default:a(()=>[l(V,null,{default:a(()=>[l(h,{headers:z,items:w.value,loading:y.value,"loading-text":"加载中...","no-data-text":"暂无数据"},{"item.actions":a(({item:t})=>[l(r,{icon:"",variant:"text",size:"small",onClick:M=>F(t)},{default:a(()=>[l(U,null,{default:a(()=>e[13]||(e[13]=[o("mdi-pencil")])),_:1,__:[13]})]),_:2},1032,["onClick"]),l(r,{icon:"",variant:"text",size:"small",color:"error",onClick:M=>j(t)},{default:a(()=>[l(U,null,{default:a(()=>e[14]||(e[14]=[o("mdi-delete")])),_:1,__:[14]})]),_:2},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),l(q,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value=t),"max-width":"600px"},{default:a(()=>[l(c,null,{default:a(()=>[l(D,null,{default:a(()=>[p("span",ae,S(g.value?"编辑学生":"添加学生"),1)]),_:1}),l(V,null,{default:a(()=>[l(ee,{ref_key:"form",ref:_,onSubmit:X(T,["prevent"])},{default:a(()=>[l(b,{modelValue:u.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.name=t),label:"姓名",rules:[t=>!!t||"姓名不能为空"],required:""},null,8,["modelValue","rules"]),l(b,{modelValue:u.value.studentId,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.studentId=t),label:"学号",rules:[t=>!!t||"学号不能为空"],required:""},null,8,["modelValue","rules"]),l(B,{modelValue:u.value.classId,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.classId=t),label:"班级",items:I.value,"item-title":"name","item-value":"id",rules:[t=>!!t||"请选择班级"],required:""},null,8,["modelValue","items","rules"])]),_:1},512)]),_:1}),l($,null,{default:a(()=>[l(N),l(r,{color:"error",variant:"text",onClick:e[6]||(e[6]=t=>i.value=!1)},{default:a(()=>e[15]||(e[15]=[o("取消")])),_:1,__:[15]}),l(r,{color:"primary",onClick:T,loading:x.value},{default:a(()=>e[16]||(e[16]=[o("保存")])),_:1,__:[16]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(q,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),"max-width":"400px"},{default:a(()=>[l(c,null,{default:a(()=>[l(D,{class:"text-h5"},{default:a(()=>e[17]||(e[17]=[o("确认删除")])),_:1,__:[17]}),l(V,null,{default:a(()=>{var t;return[e[18]||(e[18]=o("确定要删除学生 ")),p("strong",null,S((t=v.value)==null?void 0:t.name),1),e[19]||(e[19]=o(" 吗？此操作不可撤销。"))]}),_:1,__:[18,19]}),l($,null,{default:a(()=>[l(N),l(r,{color:"primary",variant:"text",onClick:e[8]||(e[8]=t=>f.value=!1)},{default:a(()=>e[20]||(e[20]=[o("取消")])),_:1,__:[20]}),l(r,{color:"error",onClick:H,loading:C.value},{default:a(()=>e[21]||(e[21]=[o("删除")])),_:1,__:[21]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Ce as default};
