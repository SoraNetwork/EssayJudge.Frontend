import{p as O,j as K,a3 as ue,c,ah as oe,q as ee,H as o,P as fe,r as $,w as ge,L as ve,x as a,y as re,Q as he,a6 as ye,R as xe,d as be,Y,W as P,X as l,_ as y,$ as k,V as Ve,ab as _e,E as we,a5 as Se}from"./index-DrtXJ76k.js";import{V as De,w as ke,x as Ce,s as Ie,j as $e,r as Ne}from"./VOverlay-D7KLqul2.js";import{B as Be,V as F,p as Te,o as p,H as Le}from"./VAvatar-D6tovhXD.js";import{V as j,a as te}from"./VRow-9Ta8N-Ip.js";import{V as X,b as U,a as G,d as q,e as Me}from"./VTextField-Cbwj9afB.js";import{c as ae,d as ze,V as Q,e as Z,f as J}from"./scopeId-C9l49y41.js";import{V as Pe}from"./VDataTable-yaTI-PlP.js";import{V as Ee}from"./VTooltip-DO5NOGv_.js";import{V as Ye}from"./VSheet-Bovs7rhU.js";import{V as Fe}from"./VForm-CzPAKgQp.js";import{a as Xe}from"./VSelect-DF8LjojY.js";import{V as Ue}from"./VSpacer-B133BwxA.js";import{V as We}from"./VDialog-BZLPLVZ4.js";/* empty css              */const de=O({autoDraw:Boolean,autoDrawDuration:[Number,String],autoDrawEasing:{type:String,default:"ease"},color:String,gradient:{type:Array,default:()=>[]},gradientDirection:{type:String,validator:e=>["top","bottom","left","right"].includes(e),default:"top"},height:{type:[String,Number],default:75},labels:{type:Array,default:()=>[]},labelSize:{type:[Number,String],default:7},lineWidth:{type:[String,Number],default:4},id:String,itemValue:{type:String,default:"value"},modelValue:{type:Array,default:()=>[]},min:[String,Number],max:[String,Number],padding:{type:[String,Number],default:8},showLabels:Boolean,smooth:[Boolean,String,Number],width:{type:[Number,String],default:300}},"Line"),me=O({autoLineWidth:Boolean,...de()},"VBarline"),le=K()({name:"VBarline",props:me(),setup(e,g){let{slots:r}=g;const d=ue(),m=c(()=>e.id||`barline-${d}`),S=c(()=>Number(e.autoDrawDuration)||500),b=c(()=>!!(e.showLabels||e.labels.length>0||r!=null&&r.label)),v=c(()=>parseFloat(e.lineWidth)||4),_=c(()=>Math.max(e.modelValue.length*v.value,Number(e.width))),D=c(()=>({minX:0,maxX:_.value,minY:0,maxY:parseInt(e.height,10)})),C=c(()=>e.modelValue.map(s=>oe(s,e.itemValue,s)));function N(s,u){const{minX:h,maxX:x,minY:V,maxY:w}=u,W=s.length;let z=e.max!=null?Number(e.max):Math.max(...s),L=e.min!=null?Number(e.min):Math.min(...s);L>0&&e.min==null&&(L=0),z<0&&e.max==null&&(z=0);const R=x/W,E=(w-V)/(z-L||1),i=w-Math.abs(L*E);return s.map((t,n)=>{const I=Math.abs(E*t);return{x:h+n*R,y:i-I+ +(t<0)*I,height:I,value:t}})}const M=c(()=>{const s=[],u=N(C.value,D.value),h=u.length;for(let x=0;s.length<h;x++){const V=u[x];let w=e.labels[x];w||(w=typeof V=="object"?V.value:V),s.push({x:V.x,value:String(w)})}return s}),f=c(()=>N(C.value,D.value)),T=c(()=>(Math.abs(f.value[0].x-f.value[1].x)-v.value)/2),B=c(()=>typeof e.smooth=="boolean"?e.smooth?2:0:Number(e.smooth));ee(()=>{const s=e.gradient.slice().length?e.gradient.slice().reverse():[""];return o("svg",{display:"block"},[o("defs",null,[o("linearGradient",{id:m.value,gradientUnits:"userSpaceOnUse",x1:e.gradientDirection==="left"?"100%":"0",y1:e.gradientDirection==="top"?"100%":"0",x2:e.gradientDirection==="right"?"100%":"0",y2:e.gradientDirection==="bottom"?"100%":"0"},[s.map((u,h)=>o("stop",{offset:h/Math.max(s.length-1,1),"stop-color":u||"currentColor"},null))])]),o("clipPath",{id:`${m.value}-clip`},[f.value.map(u=>o("rect",{x:u.x+T.value,y:u.y,width:v.value,height:u.height,rx:B.value,ry:B.value},[e.autoDraw&&o(fe,null,[o("animate",{attributeName:"y",from:u.y+u.height,to:u.y,dur:`${S.value}ms`,fill:"freeze"},null),o("animate",{attributeName:"height",from:"0",to:u.height,dur:`${S.value}ms`,fill:"freeze"},null)])]))]),b.value&&o("g",{key:"labels",style:{textAnchor:"middle",dominantBaseline:"mathematical",fill:"currentColor"}},[M.value.map((u,h)=>{var x;return o("text",{x:u.x+T.value+v.value/2,y:parseInt(e.height,10)-2+(parseInt(e.labelSize,10)||7*.75),"font-size":Number(e.labelSize)||7},[((x=r.label)==null?void 0:x.call(r,{index:h,value:u.value}))??u.value])})]),o("g",{"clip-path":`url(#${m.value}-clip)`,fill:`url(#${m.value})`},[o("rect",{x:0,y:0,width:Math.max(e.modelValue.length*v.value,Number(e.width)),height:e.height},null)])])})}});function Re(e,g){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:75;if(e.length===0)return"";const m=e.shift(),S=e[e.length-1];return(r?`M${m.x} ${d-m.x+2} L${m.x} ${m.y}`:`M${m.x} ${m.y}`)+e.map((b,v)=>{const _=e[v+1],D=e[v-1]||m,C=_&&Ae(_,b,D);if(!_||C)return`L${b.x} ${b.y}`;const N=Math.min(ne(D,b),ne(_,b)),f=N/2<g?N/2:g,T=se(D,b,f),B=se(_,b,f);return`L${T.x} ${T.y}S${b.x} ${b.y} ${B.x} ${B.y}`}).join("")+(r?`L${S.x} ${d-m.x+2} Z`:"")}function H(e){return parseInt(e,10)}function Ae(e,g,r){return H(e.x+r.x)===H(2*g.x)&&H(e.y+r.y)===H(2*g.y)}function ne(e,g){return Math.sqrt(Math.pow(g.x-e.x,2)+Math.pow(g.y-e.y,2))}function se(e,g,r){const d={x:e.x-g.x,y:e.y-g.y},m=Math.sqrt(d.x*d.x+d.y*d.y),S={x:d.x/m,y:d.y/m};return{x:g.x+S.x*r,y:g.y+S.y*r}}const ce=O({fill:Boolean,...de()},"VTrendline"),ie=K()({name:"VTrendline",props:ce(),setup(e,g){let{slots:r}=g;const d=ue(),m=c(()=>e.id||`trendline-${d}`),S=c(()=>Number(e.autoDrawDuration)||(e.fill?500:2e3)),b=$(0),v=$(null);function _(s,u){const{minX:h,maxX:x,minY:V,maxY:w}=u,W=s.length,z=e.max!=null?Number(e.max):Math.max(...s),L=e.min!=null?Number(e.min):Math.min(...s),R=(x-h)/(W-1),E=(w-V)/(z-L||1);return s.map((i,t)=>({x:h+t*R,y:w-(i-L)*E,value:i}))}const D=c(()=>!!(e.showLabels||e.labels.length>0||r!=null&&r.label)),C=c(()=>parseFloat(e.lineWidth)||4),N=c(()=>Number(e.width)),M=c(()=>{const s=Number(e.padding);return{minX:s,maxX:N.value-s,minY:s,maxY:parseInt(e.height,10)-s}}),f=c(()=>e.modelValue.map(s=>oe(s,e.itemValue,s))),T=c(()=>{const s=[],u=_(f.value,M.value),h=u.length;for(let x=0;s.length<h;x++){const V=u[x];let w=e.labels[x];w||(w=typeof V=="object"?V.value:V),s.push({x:V.x,value:String(w)})}return s});ge(()=>e.modelValue,async()=>{if(await ve(),!e.autoDraw||!v.value)return;const s=v.value,u=s.getTotalLength();e.fill?(s.style.transformOrigin="bottom center",s.style.transition="none",s.style.transform="scaleY(0)",s.getBoundingClientRect(),s.style.transition=`transform ${S.value}ms ${e.autoDrawEasing}`,s.style.transform="scaleY(1)"):(s.style.strokeDasharray=`${u}`,s.style.strokeDashoffset=`${u}`,s.getBoundingClientRect(),s.style.transition=`stroke-dashoffset ${S.value}ms ${e.autoDrawEasing}`,s.style.strokeDashoffset="0"),b.value=u},{immediate:!0});function B(s){const u=typeof e.smooth=="boolean"?e.smooth?8:0:Number(e.smooth);return Re(_(f.value,M.value),u,s,parseInt(e.height,10))}ee(()=>{var u;const s=e.gradient.slice().length?e.gradient.slice().reverse():[""];return o("svg",{display:"block","stroke-width":parseFloat(e.lineWidth)??4},[o("defs",null,[o("linearGradient",{id:m.value,gradientUnits:"userSpaceOnUse",x1:e.gradientDirection==="left"?"100%":"0",y1:e.gradientDirection==="top"?"100%":"0",x2:e.gradientDirection==="right"?"100%":"0",y2:e.gradientDirection==="bottom"?"100%":"0"},[s.map((h,x)=>o("stop",{offset:x/Math.max(s.length-1,1),"stop-color":h||"currentColor"},null))])]),D.value&&o("g",{key:"labels",style:{textAnchor:"middle",dominantBaseline:"mathematical",fill:"currentColor"}},[T.value.map((h,x)=>{var V;return o("text",{x:h.x+C.value/2+C.value/2,y:parseInt(e.height,10)-4+(parseInt(e.labelSize,10)||7*.75),"font-size":Number(e.labelSize)||7},[((V=r.label)==null?void 0:V.call(r,{index:x,value:h.value}))??h.value])})]),o("path",{ref:v,d:B(e.fill),fill:e.fill?`url(#${m.value})`:"none",stroke:e.fill?"none":`url(#${m.value})`},null),e.fill&&o("path",{d:B(!1),fill:"none",stroke:e.color??((u=e.gradient)==null?void 0:u[0])},null)])})}}),pe=O({type:{type:String,default:"trend"},...me(),...ce()},"VSparkline"),je=K()({name:"VSparkline",props:pe(),setup(e,g){let{slots:r}=g;const{textColorClasses:d,textColorStyles:m}=Be(()=>e.color),S=c(()=>!!(e.showLabels||e.labels.length>0||r!=null&&r.label)),b=c(()=>{let v=parseInt(e.height,10);return S.value&&(v+=parseInt(e.labelSize,10)*1.5),v});ee(()=>{const v=e.type==="trend"?ie:le,_=e.type==="trend"?ie.filterProps(e):le.filterProps(e);return a(v,re({key:e.type,class:d.value,style:m.value,viewBox:`0 0 ${e.width} ${parseInt(b.value,10)}`},_),r)})}}),qe={key:0,class:"d-flex justify-center align-center",style:{height:"400px"}},He={key:1,class:"text-center py-8"},Oe={class:"text-h5 text-error"},Ge={key:2},Qe={class:"text-h4 text-white"},Ze={class:"text-h5 mb-1"},Je={class:"text-subtitle-1 text-medium-emphasis mb-4"},Ke={class:"text-h4 font-weight-bold"},et={class:"text-h4 font-weight-bold"},tt={key:1},ht=he({__name:"[id]",setup(e){const g=ye();xe();const r=c(()=>g.params.id),d=$({id:"",name:"",studentId:"",classId:"",className:"",phone:"",email:""}),m=$([]),S=$([]),b=$(!0),v=$(!0),_=$(!0),D=$(""),C=$(!1),N=$(!1),M=$(null),f=$({name:"",studentId:"",classId:"",phone:"",email:""}),T=[{title:"测验题目",key:"assignmentTitle"},{title:"状态",key:"status"},{title:"分数",key:"score"},{title:"提交时间",key:"submissionDate"},{title:"操作",key:"actions",sortable:!1}],B=c(()=>{const i=m.value.filter(n=>n.status==="Evaluated"&&n.score!==void 0);return i.length===0?"-":(i.reduce((n,I)=>n+I.score,0)/i.length).toFixed(1)}),s=c(()=>m.value.some(i=>i.status==="Evaluated"&&i.score!==void 0)),u=c(()=>m.value.filter(i=>i.status==="Evaluated"&&i.score!==void 0).sort((i,t)=>new Date(i.submissionDate).getTime()-new Date(t.submissionDate).getTime()).map(i=>i.score));async function h(){var i,t;b.value=!0,D.value="";try{const n=await ke(r.value);if(!n){D.value="未找到学生信息";return}let I="";if(n.classId)try{const A=await Ce(n.classId);I=(A==null?void 0:A.name)||""}catch(A){console.error("获取班级信息失败:",A)}d.value={...n,className:I},f.value={name:d.value.name,studentId:d.value.studentId,classId:d.value.classId,phone:d.value.phone,email:d.value.email},await x(),await V()}catch(n){console.error("获取学生详情失败:",n),D.value=((t=(i=n.response)==null?void 0:i.data)==null?void 0:t.message)||"获取学生详情失败"}finally{b.value=!1}}async function x(){v.value=!0;try{const i=await Ie({studentId:r.value}),t=await Promise.all(i.map(async n=>n));m.value=t}catch(i){console.error("获取作文提交列表失败:",i)}finally{v.value=!1}}async function V(){_.value=!0;try{const i=await $e();S.value=i||[]}catch(i){console.error("获取班级列表失败:",i)}finally{_.value=!1}}async function w(){var t,n;const{valid:i}=await M.value.validate();if(i){N.value=!0;try{await Ne(d.value.id,f.value),C.value=!1,await h()}catch(I){console.error("保存学生信息失败:",I),alert(((n=(t=I.response)==null?void 0:t.data)==null?void 0:n.message)||"保存学生信息失败，请稍后重试")}finally{N.value=!1}}}function W(i){return i?i.charAt(0).toUpperCase():"?"}function z(i){return i?new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}function L(i){return{Submitted:"已提交",Evaluating:"评测中",Evaluated:"已评测"}[i]||i}function R(i){return{Submitted:"info",Evaluating:"warning",Evaluated:"success"}[i]||"grey"}function E(i){return i>=90?"text-success":i>=80?"text-info":i>=60?"text-warning":"text-error"}return be(()=>{h()}),(i,t)=>(P(),Y("div",null,[a(F,{class:"mb-4","prepend-icon":"mdi-arrow-left",variant:"text",to:"/students"},{default:l(()=>t[8]||(t[8]=[y("返回学生列表")])),_:1,__:[8]}),b.value?(P(),Y("div",qe,[a(Te,{indeterminate:"",color:"primary",size:"64"})])):D.value?(P(),Y("div",He,[a(p,{color:"error",size:"64",class:"mb-4"},{default:l(()=>t[9]||(t[9]=[y("mdi-alert-circle")])),_:1,__:[9]}),o("h2",Oe,k(D.value),1),a(F,{class:"mt-4",color:"primary",to:"/students"},{default:l(()=>t[10]||(t[10]=[y("返回学生列表")])),_:1,__:[10]})])):(P(),Y("div",Ge,[a(te,null,{default:l(()=>[a(j,{cols:"12",md:"4"},{default:l(()=>[a(X,null,{default:l(()=>[a(U,{class:"text-center pt-6"},{default:l(()=>[a(Le,{size:"120",color:"primary",class:"mb-4"},{default:l(()=>[o("span",Qe,k(W(d.value.name)),1)]),_:1}),o("h2",Ze,k(d.value.name),1),o("p",Je,k(d.value.className||"未分配班级"),1),a(ae,{class:"mb-4"}),a(ze,null,{default:l(()=>[a(Q,null,{prepend:l(()=>[a(p,{color:"primary"},{default:l(()=>t[11]||(t[11]=[y("mdi-account")])),_:1,__:[11]})]),default:l(()=>[a(Z,null,{default:l(()=>t[12]||(t[12]=[y("学号")])),_:1,__:[12]}),a(J,null,{default:l(()=>[y(k(d.value.studentId||"未设置"),1)]),_:1})]),_:1}),a(Q,null,{prepend:l(()=>[a(p,{color:"primary"},{default:l(()=>t[13]||(t[13]=[y("mdi-phone")])),_:1,__:[13]})]),default:l(()=>[a(Z,null,{default:l(()=>t[14]||(t[14]=[y("联系电话")])),_:1,__:[14]}),a(J,null,{default:l(()=>[y(k(d.value.phone||"未设置"),1)]),_:1})]),_:1}),a(Q,null,{prepend:l(()=>[a(p,{color:"primary"},{default:l(()=>t[15]||(t[15]=[y("mdi-email")])),_:1,__:[15]})]),default:l(()=>[a(Z,null,{default:l(()=>t[16]||(t[16]=[y("电子邮箱")])),_:1,__:[16]}),a(J,null,{default:l(()=>[y(k(d.value.email||"未设置"),1)]),_:1})]),_:1})]),_:1}),a(ae,{class:"my-4"}),a(F,{block:"",color:"primary","prepend-icon":"mdi-pencil",onClick:t[0]||(t[0]=n=>C.value=!0),class:"mb-2"},{default:l(()=>t[17]||(t[17]=[y(" 编辑学生信息 ")])),_:1,__:[17]})]),_:1})]),_:1}),a(te,{class:"mt-4"},{default:l(()=>[a(j,{cols:"6"},{default:l(()=>[a(X,null,{default:l(()=>[a(U,{class:"text-center"},{default:l(()=>[o("div",Ke,k(m.value.length),1),t[18]||(t[18]=o("div",{class:"text-subtitle-2"},"作文提交",-1))]),_:1,__:[18]})]),_:1})]),_:1}),a(j,{cols:"6"},{default:l(()=>[a(X,null,{default:l(()=>[a(U,{class:"text-center"},{default:l(()=>[o("div",et,k(B.value),1),t[19]||(t[19]=o("div",{class:"text-subtitle-2"},"平均分",-1))]),_:1,__:[19]})]),_:1})]),_:1})]),_:1})]),_:1}),a(j,{cols:"12",md:"8"},{default:l(()=>[a(X,null,{default:l(()=>[a(G,null,{default:l(()=>t[20]||(t[20]=[y("作文提交历史")])),_:1,__:[20]}),a(U,null,{default:l(()=>[a(Pe,{headers:T,items:m.value,loading:v.value,"loading-text":"加载中...","no-data-text":"暂无作文提交"},{"item.assignmentTitle":l(({item:n})=>[a(Ee,{location:"top"},{activator:l(({props:I})=>[o("span",re(I,{class:"text-truncate d-inline-block",style:{"max-width":"200px"}}),k(n.assignmentTitle),17)]),default:l(()=>[o("span",null,k(n.assignmentTitle),1)]),_:2},1024)]),"item.status":l(({item:n})=>[a(De,{color:R(n.status),variant:"outlined",size:"small"},{default:l(()=>[y(k(L(n.status)),1)]),_:2},1032,["color"])]),"item.score":l(({item:n})=>[n.status==="Evaluated"?(P(),Y("span",{key:0,class:we(E(n.score))},k(n.score),3)):(P(),Y("span",tt,"-"))]),"item.submissionDate":l(({item:n})=>[y(k(z(n.submissionDate)),1)]),"item.actions":l(({item:n})=>[a(F,{icon:"",variant:"text",size:"small",to:`/essays/${n.id}`},{default:l(()=>[a(p,null,{default:l(()=>t[21]||(t[21]=[y("mdi-eye")])),_:1,__:[21]})]),_:2},1032,["to"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),s.value?(P(),Ve(X,{key:0,class:"mt-4"},{default:l(()=>[a(G,null,{default:l(()=>t[22]||(t[22]=[y("成绩趋势")])),_:1,__:[22]}),a(U,null,{default:l(()=>[a(Ye,{height:"300"},{default:l(()=>[a(je,{value:u.value,gradient:["#1867C0","#5CBBF6"],smooth:10,padding:8,"line-width":2,"stroke-linecap":"round","gradient-direction":"top","auto-draw":"","auto-line-width":"","show-labels":"","label-size":5},null,8,["value"])]),_:1})]),_:1})]),_:1})):_e("",!0)]),_:1})]),_:1}),a(We,{modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=n=>C.value=n),"max-width":"600px"},{default:l(()=>[a(X,null,{default:l(()=>[a(G,{class:"text-h5"},{default:l(()=>t[23]||(t[23]=[y("编辑学生信息")])),_:1,__:[23]}),a(U,null,{default:l(()=>[a(Fe,{ref_key:"form",ref:M,onSubmit:Se(w,["prevent"])},{default:l(()=>[a(q,{modelValue:f.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>f.value.name=n),label:"姓名",rules:[n=>!!n||"姓名不能为空"],required:""},null,8,["modelValue","rules"]),a(q,{modelValue:f.value.studentId,"onUpdate:modelValue":t[2]||(t[2]=n=>f.value.studentId=n),label:"学号"},null,8,["modelValue"]),a(Xe,{modelValue:f.value.classId,"onUpdate:modelValue":t[3]||(t[3]=n=>f.value.classId=n),items:S.value,"item-title":"name","item-value":"id",label:"班级",clearable:"",loading:_.value},null,8,["modelValue","items","loading"]),a(q,{modelValue:f.value.phone,"onUpdate:modelValue":t[4]||(t[4]=n=>f.value.phone=n),label:"联系电话"},null,8,["modelValue"]),a(q,{modelValue:f.value.email,"onUpdate:modelValue":t[5]||(t[5]=n=>f.value.email=n),label:"电子邮箱",rules:[n=>!n||/.+@.+\..+/.test(n)||"请输入有效的邮箱地址"]},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),a(Me,null,{default:l(()=>[a(Ue),a(F,{color:"error",variant:"text",onClick:t[6]||(t[6]=n=>C.value=!1)},{default:l(()=>t[24]||(t[24]=[y("取消")])),_:1,__:[24]}),a(F,{color:"primary",onClick:w,loading:N.value},{default:l(()=>t[25]||(t[25]=[y("保存")])),_:1,__:[25]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))]))}});export{ht as default};
